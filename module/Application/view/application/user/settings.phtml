<?php
$title = $this->translate('Settings');
$this->headTitle($title);
?>
<div role="main" class="two-column-section clearfix">
    <div class="first-column registration settings">
    <h1><?php echo $this->escapeHtml($title);?></h1>
    <?php if ($this->user->getFacebookId()):?>
        <?php echo $this->partial('partials/flash-messages');?>
    <?php endif; ?>

    <?php if (!$this->user->getFacebookId()):?>
    <aside class="connect-facebook clearfix">
        <div>
            <h2><?php echo $this->translate('Connect your account for a one click login');?></h2>
            <p><?=$this->translate(\Application\Model\Helpers\MessagesConstants::INFO_FACEBOOK_CONNECT_BUTTON)?></p>
        </div>
        <?php echo $this->renderFacebookButton($this->translate('Connect with Facebook'));?>
    </aside>
    <?php echo $this->partial('partials/flash-messages');?>
    <!--PASSWORD FORM START-->
        <?php
            $this->passwordForm->prepare();
            $this->passwordForm->setAttribute('action', $this->url('user-settings'));
            echo $this->form()->openTag($this->passwordForm);
        ?>
        <section>
            <div>
                <h2><?php echo $this->translate('Change your Password');?></h2>
            </div>
            <div>
                <?php echo $this->formLabel($this->passwordForm->get('password')); ?>
                <?php  echo $this->formElement($this->passwordForm->get('password')); ?>
            </div>
            <div>
                <?php echo $this->formLabel($this->passwordForm->get('new_password')); ?>
                <?php  echo $this->formElement($this->passwordForm->get('new_password')); ?>
            </div>
            <div>
                <?php echo $this->formLabel($this->passwordForm->get('confirm_new_password')); ?>
                <?php  echo $this->formElement($this->passwordForm->get('confirm_new_password')); ?>
            </div>
            <div class="buttons">
                <button type="submit"><?php echo $this->translate('Save changes');?></button>
            </div>
        </section>
        <?php
            echo $this->formHidden($this->passwordForm->get('type'));
            echo $this->form()->closeTag();
        ?>
    <!--PASSWORD FORM END-->

    <!--EMAIL FORM START-->
        <?php
            $this->emailForm->prepare();
            $this->emailForm->setAttribute('action', $this->url('user-settings'));
            echo $this->form()->openTag($this->emailForm);
        ?>

        <section>
            <div>
                <h2><?php echo $this->translate('Change Your Email Addresses');?></h2>
            </div>
            <div>
                <?php echo $this->formLabel($this->emailForm->get('email')); ?>
                <?php  echo $this->formElement($this->emailForm->get('email')); ?>
            </div>
            <div>
                <?php echo $this->formLabel($this->emailForm->get('confirm_email')); ?>
                <?php  echo $this->formElement($this->emailForm->get('confirm_email')); ?>
            </div>
            <div class="buttons">
                <button type="submit"><?php echo $this->translate('Save changes');?></button>
            </div>
        </section>
        <?php
            echo $this->formHidden($this->emailForm->get('type'));
            echo $this->form()->closeTag();
        ?>
    <!--EMAIL FORM END-->

    <!--DISPLAY NAME FORM START-->
        <?php
            $this->displayNameForm->prepare();
            $this->displayNameForm->setAttribute('action', $this->url('user-settings'));
            echo $this->form()->openTag($this->displayNameForm);
        ?>

    <section>
        <div>
            <h2><?php echo $this->translate('Change Your Display Name');?></h2>
        </div>
        <div>
            <?php echo $this->formLabel($this->displayNameForm->get('display_name')); ?>
            <?php  echo $this->formElement($this->displayNameForm->get('display_name')); ?>
        </div>
        <div class="buttons">
            <button type="submit"><?php echo $this->translate('Save changes');?></button>
        </div>
    </section>
        <?php
        echo $this->formHidden($this->displayNameForm->get('type'));
        echo $this->form()->closeTag();
        ?>
    <!--DISPLAY NAME FORM END-->

    <!--AVATAR FORM START-->
        <?php
        $this->avatarForm->prepare();
        $this->avatarForm->setAttribute('action', $this->url('user-settings'));
        echo $this->form()->openTag($this->avatarForm);
        ?>

    <section>
        <div>
            <h2><?php echo $this->translate('Change Your Avatar');?></h2>
        </div>
        <div class="block-input-file change-avatar">
            <img src="<?php echo $this->user->getAvatar()->getSmallImagePath();?>" alt="<?php echo $this->translate('User avatar');?>"/>
            <?php echo $this->formLabel($this->avatarForm->get('avatar')); ?>
            <?php  echo $this->formElement($this->avatarForm->get('avatar')); ?>
        </div>
        <div class="avatar ideal-full-width claerfix">
            <label class="desktopLabel"><?php echo $this->translate('Or choose from selection');?></label>
            <?php echo $this->renderDefaultAvatars();?>
        </div>
        <div class="buttons">
            <button type="submit"><?php echo $this->translate('Save changes');?></button>
        </div>
    </section>
        <?php
        echo $this->formHidden($this->avatarForm->get('type'));
        echo $this->form()->closeTag();
        ?>
    <!--AVATAR FORM END-->
    <?php endif;?>
    <!--REGIONAL SETTINGS FORM START-->
    <?php
        $this->languageForm->prepare();
        $this->languageForm->setAttribute('action', $this->url('user-settings'));
        echo $this->form()->openTag($this->languageForm);
    ?>

        <section>
            <div>
                <h2><?php echo $this->translate('Regional Settings');?></h2>
            </div>
            <div class="field">
                <label><?php echo $this->translate('Your country');?></label>
                <p>
                    <strong><?php echo $this->user->getCountry()->getName();?></strong>
                    <small><?php echo $this->translate('You cannot change your country in the middle of a league. We will prompt you to re-confirm your details at the start of the the league.');?></small>
                </p>
            </div>
            <div>
                <?php echo $this->formLabel($this->languageForm->get('language')); ?>
                <?php  echo $this->formElement($this->languageForm->get('language')); ?>
            </div>
            <div class="buttons">
                <button type="submit"><?php echo $this->translate('Save changes');?></button>
            </div>
        </section>
    <?php
    echo $this->formHidden($this->languageForm->get('type'));
    echo $this->form()->closeTag();
    ?>
    <!--TERMS FORM START-->
    <?php if (!is_null($this->termsForm)):?>
        <?php
        $this->termsForm->prepare();
        $this->termsForm->setAttribute('action', $this->url('user-settings'));
        echo $this->form()->openTag($this->termsForm);
        ?>
        <?php $termsFieldset = $this->termsForm->getTermsFieldset();?>
        <?php if (!empty($termsFieldset)):?>
            <section class="email-settings">
                <div>
                    <h2><?php echo $this->translate('Terms');?></h2>
                </div>
                <div>
                    <?php foreach($termsFieldset->getElements() as $term):?>
                        <label>
                            <?php echo $this->formCheckbox($term);?>
                            <?php echo $term->getLabel();?>
                        </label>
                    <?php endforeach;?>
                </div>
                <div class="buttons">
                    <button type="submit"><?php echo $this->translate('Save changes');?></button>
                </div>
            </section>
        <?php endif;?>
        <?php
        echo $this->formHidden($this->termsForm->get('type'));
        echo $this->form()->closeTag();
        ?>
    <?php endif;?>
    <!--TERMS FORM END-->
    <section class="bn ideal-form">
        <div class="ideal-wrap ideal-full-width">
            <h2><?php echo $this->translate('Delete Account');?></h2>
        </div>
        <div class="buttons">
            <a href="<?php echo $this->url('delete-account');?>"><?php echo $this->translate('Delete Account');?></a>
        </div>
    </section>
   </div>
    <?php echo $this->partial('partials/right-column');?>
</div>
<script type="text/javascript">
    var turnOffCustomStylePoint = 767;

    //Password form
    var passwordOptions = {

        responsiveAt: turnOffCustomStylePoint,
        onFail: function(){},
        onSuccess: function(){},
        inputs: {
            'password': {
                filters: 'required max',
                data: { max: 15 }
            },
            'new_password': {
                filters: 'required pass max',
                data: { max: 15 }
            },
            'confirm_new_password': {
                filters: 'required max equalto',
                data: {
                    max: 15,
                    equalto : '#new-password'
                }
            }
        }
    };
    //Email form
    var emailOptions = {

        responsiveAt: turnOffCustomStylePoint,
        onFail: function(){},
        onSuccess: function(){},
        inputs: {
            'email': {
                filters: 'required email max',
                data: { max: 50 }
            },
            'confirm_email': {
                filters: 'required email max equalto',
                data: {
                    max: 50,
                    equalto : '#settings-email'
                }
            }

        }
    };

    //Display Name
    var displayNameOptions = {
        responsiveAt: turnOffCustomStylePoint,
        onFail: function(){},
        onSuccess: function(){},
        inputs: {
            'display_name': {
                filters: 'required max',
                data: { max: 20 }
            }
        }
    };

    //Avatar Form
    var avatarOptions = {
        responsiveAt: turnOffCustomStylePoint,
        onFail: function(){},
        onSuccess: function(){},
        inputs: {
            'avatar': {
                filters: 'extension',
                data: { extension: [ 'jpg', 'png', 'jpeg','gif', 'bmp'] }
            }
        }
    };

    //Language Form
    var languageOptions = {
        responsiveAt: turnOffCustomStylePoint,
        onFail: function(){},
        onSuccess: function(){}
    };

    //Email Settings Form
    var emailSettingsOptions = {
        responsiveAt: turnOffCustomStylePoint,
        onFail: function(){},
        onSuccess: function(){}
    };

    //Public profile Form
    /*var publicProfileOptions = {
        responsiveAt: turnOffCustomStylePoint,
        onFail: function(){},
        onSuccess: function(){}
    };*/
    if ($(document).width() <  turnOffCustomStylePoint){
        passwordOptions.disableCustom = 'select';
        emailOptions.disableCustom = 'select';
        displayNameOptions.disableCustom = 'select';
        avatarOptions.disableCustom = 'select';
        languageOptions.disableCustom = 'select';
        emailSettingsOptions.disableCustom = 'select';
    }

    //settings-change-public-profile
    try {
        $('#settings-change-password').idealforms(passwordOptions).data('idealforms');
    } catch (e) {}
    try {
        $('#settings-change-email').idealforms(emailOptions).data('idealforms');
    } catch (e) {}
    try {
        $('#settings-change-display-name').idealforms(displayNameOptions).data('idealforms');
    } catch (e) {}
    try {
        $('#settings-change-avatar').idealforms(avatarOptions).data('idealforms');
    } catch (e) {}
    try {
        $('#settings-change-language').idealforms(languageOptions).data('idealforms');
    } catch (e) {}
    try {
        $('#settings-change-terms').idealforms(emailSettingsOptions).data('idealforms');
    } catch (e) {}
   //$('#settings-change-public-profile').idealforms(publicProfileOptions).data('idealforms');

</script>