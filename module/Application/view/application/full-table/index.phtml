<?php
$this->headTitle($this->leagueName . ' - ' . $this->seasonName);
?>
<?php if (!$this->onlyRows) : ?>
    <div role="main" class="two-column-section clearfix">
        <div class="first-column league-tables">
            <?php if ($this->league->getType() == \Application\Model\Entities\League::PRIVATE_TYPE) : ?>
                <link rel="stylesheet" href="/css/private-league.css">
                <?php if ($this->league->getCreator()->getId() == $this->getCurrentUser()->getId()) : ?>
                    <div style="display: none" id="private-league-code"><?=$this->league->getPrivateLeague()->getUniqueHash()?></div>
                    <a href="#" id="league-code-button" class="more-info private-league-button"><?=$this->translate('League Code')?></a>
                    <a href="#" id="league-edit-button" class="more-info private-league-button"><?=$this->translate('Edit')?></a>
                    <a href="<?=$this->url('delete-private-league', array('code' => $this->league->getPrivateLeague()->getUniqueHash()))?>"
                       id="league-delete-button" style="display: none" class="more-info private-league-button"
                       title="<?=$this->translate('Are you sure that you want to delete the league?')?>"><?=$this->translate('Delete')?></a>
                <?php else : ?>
                    <a href="<?=$this->url('leave-private-league', array('code' => $this->league->getPrivateLeague()->getUniqueHash()))?>"
                       id="league-leave-button" class="more-info private-league-button"
                       title="<?=$this->translate('Are you sure you want to be removed permanently from this private league?')?>"><?=$this->translate('Leave')?></a>
                <?php endif; ?>
            <?php endif; ?>
            <h1><?=$this->translate('League Table')?></h1>
            <div class="league">
                <header class="clearfix">
                    <h2><?=$this->seasonName?></h2>
                    <form id="season-filter">
                        <div>
                            <select name='league-filter' id='league-filter'>
                                <option value="everyone" selected="selected"><?=$this->translate('Everyone')?></option>
                                <?php if ($this->getCurrentUser()->getFacebookId() !== null) : ?>
                                    <option value="your-friends"><?=$this->translate('Your friends')?></option>
                                <?php endif; ?>
                                <option value="you-and-around"><?=$this->translate('You and around you')?></option>
                            </select>
                        </div>
                    </form>
                </header>
                <?php echo $this->partial('partials/flash-messages');?>
                <section>
                    <div class="block">
                        <table id='league-table'>
                            <tr>
                                <th colspan="3">
                                    <h3><?=$this->leagueName?></h3>
                                </th>
                                <th><abbr title="Points"><?=$this->translate('pts')?></abbr></th>
                            </tr>
                            <?php endif; ?>
                            <?php foreach ($this->leagueUsers as $user) : $isActive = $user['userId'] == $this->getCurrentUser()->getId(); ?>
                            <tr<?=$isActive ? ' class="your-table-position"' : ''?>>
                                <td class="position">
                                    <?php if ($isActive) : ?><span><?php endif;?>
                                    <?=$user['place'] !== null ? $user['place'] : '&ndash;'?>
                                    <?php if ($isActive) : ?></span><?php endif;?>
                                </td>
                                <td class="player">
                                    <?=$user['displayName']?>
                                    <?php if ($this->league->getType() == \Application\Model\Entities\League::PRIVATE_TYPE &&
                                        $this->league->getCreator()->getId() == $this->getCurrentUser()->getId() && $user['userId'] != $this->getCurrentUser()->getId()) : ?>
                                        &nbsp;<a href="<?=$this->url('remove-user-from-private-league', array('code' => $this->league->getPrivateLeague()->getUniqueHash(), 'id' => $user['userId']))?>"
                                                 title="<?=$this->translate('Are you sure you want to remove the user permanently from this private league?')?>"
                                                 style="display: none" class="remove-player">X</a>
                                    <?php endif; ?>
                                </td>
                                <td class="nationality"><img src="<?=$user['flagImage']?>" itemprop="nationality" alt="<?=$user['country']?>"></td>
                                <td class="points">
                                    <?php if ($isActive) : ?><span><?php endif;?>
                                    <?=$user['points'] !== null ? $user['points'] : '-'?>
                                    <?php if ($isActive) : ?></span><?php endif;?>
                                </td>
                            </tr>
                            <?php endforeach; ?>
                            <?php if (!$this->onlyRows) : ?>
                        </table>
                        <input type="hidden" id="users-count" value="<?=$this->leagueUsersCount?>"/>
                    </div>
                </section>
                <?php if ($this->leagueUsersCount > $this->perPage) : ?>
                    <p class="align-center">
                        <a href="#" class="show-more" id='show-more'><?=$this->translate('Show more')?></a>
                    </p>
                <?php endif; ?>
            </div>
        </div>
        <?php echo $this->partial('partials/right-column'); ?>
    </div>
    <script type="text/javascript" src="/js/league-table.js"></script>
<?php endif; ?>